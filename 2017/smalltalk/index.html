<!DOCTYPE html>
<html lang="zh">
    <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <!--<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">-->
    
    <title>Smalltalk 入门学习 | Mの综合研究</title>
    <link href="https://cdn.bootcss.com/normalize/8.0.0/normalize.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
    <body>
      
<header role="banner" id="site-banner" class="unselectable center ">
    
        <a id="site-logo" href="/"><span class="site-logo-large">Mの</span><br /><span>综合研究</span></a>
    
    <nav role="navigation" id="site-nav">
        <ul>
        
            <li><a href="/categories/proj" class="intent3"><i class="icon-folder"></i>&nbsp;项目</a></li>
        
            <li><a href="/categories/tech" class=""><i class="icon-cog"></i>&nbsp;技术</a></li>
        
            <li><a href="/categories/life" class=""><i class="icon-heart"></i>&nbsp;生活</a></li>
        
            <li><a href="/idea" class=""><i class="icon-hangouts"></i>&nbsp;想法</a></li>
        
            <li><a href="/about" class=""><i class="icon-user"></i>&nbsp;关于</a></li>
              
        </ul>
    </nav>
</header>
      <main role="main" class="center">
        
<article class="post">
    <h1 class="">Smalltalk 入门学习</h1>
    <time class="">2017/10/05</time>
    <section><blockquote>
<p>旧笔记补档，原来是为 2017-10-06 线下 MAP 活动做的笔记</p>
<p>参考资料：</p>
<ul>
<li>I Can Read C++ and Java But I Can’t Read Smalltalk</li>
<li><a href="http://www.vaikan.com/why-i-love-smalltalk/" target="_blank" rel="noopener">Why I love smalltalk</a></li>
</ul>
</blockquote>
<a id="more"></a>
<h1 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h1><ul>
<li><p>注释： <code>&quot;this is comment&quot;</code></p>
</li>
<li><p>字符串：<code>&#39;this is string&#39;</code></p>
</li>
<li><p>字符： <code>$c</code></p>
</li>
<li><p>符号（Symbol）： <code>#&#39;this is a symbol&#39;</code> / <code>#thisIsASymbolToo</code></p>
</li>
<li><p><code>:=</code> 赋值语句</p>
</li>
<li><p><code>=</code> 相等性 (equals)</p>
</li>
<li><p><code>==</code> 同一性</p>
</li>
<li><p>数组： <code>#(1 2 3 4 5)</code></p>
</li>
<li><p>字符串连接： <code>&#39;string1&#39;, &#39;string2&#39;</code></p>
</li>
</ul>
<h1 id="方法调用"><a href="#方法调用" class="headerlink" title="方法调用"></a>方法调用</h1><blockquote>
<p>关键词无处不在</p>
</blockquote>
<p>在对象上调用方法，实际上是给这个对象发送一个消息</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">t-&gt;rotate(a, v); // <span class="type">For</span> <span class="type">C</span>++</span><br><span class="line">t.rotate(a, v);   // <span class="type">For</span> <span class="type">Java</span></span><br><span class="line">t rotate(a, v);    // 省略 dot</span><br><span class="line">t rotate a, v;     // 省略括号</span><br><span class="line">t rotate by a around v;      // 语义化，但是分不清哪个是关键词哪个是参数</span><br><span class="line">t rotate by: a around: v;    // 为分隔词增加一个冒号来区分</span><br><span class="line">t rotateBy: a around: v;     // 干脆把方法名也省略了... <span class="type">This</span> is smalltalk</span><br></pre></td></tr></table></figure>
<p>如何在 Smalltalk 中定义一个方法：</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rotateBy: angle around: vector</span><br><span class="line">  | result |</span><br><span class="line">  result := <span class="type">COMPUTE</span> <span class="type">ANSWER</span>.</span><br><span class="line">  ^result</span><br></pre></td></tr></table></figure>
<p>好处：方便理解、不需要记忆参数的个数、顺序（当然也要方法定义的好） </p>
<p><code>rotateBy:</code> 这种，以冒号结尾的，称为 keyword </p>
<p>但是如果是无参的方法，可以省略冒号</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t makeIdentity</span><br></pre></td></tr></table></figure>
<hr>
<p>Smalltalk 里面可以有二元操作符，但是没有一元操作符（因为只有一元的 message，二维的话有 &amp;，| 之类的）</p>
<p>如下例：</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a negative | (b between: c and: d)</span><br><span class="line">  ifTrue: [a := c negated]</span><br></pre></td></tr></table></figure>
<p>相当于别的语言的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a &lt; <span class="number">0</span> || (c &lt; b &amp;&amp; b &lt; d)) &#123;</span><br><span class="line">    a = -c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要点：</p>
<ul>
<li>Smalltalk 里不能写 <code>a = -c</code> ，因为没有一元操作符（-），但是可以写 -5，因为 -5 整体可以视为一个常量。</li>
<li><code>ifTrue: [a := c negated]</code> 整体是一个 message，传递给 <code>boolean</code> 对象。 <code>ifTrue:</code> 是 keyword，后面是一个代码块参数。</li>
</ul>
<hr>
<p>运算的优先级顺序： </p>
<p>从左到右，无参消息 &gt; 二元 &gt; 关键词（keyword） </p>
<p>所以 <code>1+2*3 = 9</code> 因为 + 和 * 的优先级是同级的，从左到右计算。但是一般会写成 <code>(1+2)*3</code> 以避免误解。</p>
<h1 id="句号和分号"><a href="#句号和分号" class="headerlink" title="句号和分号"></a>句号和分号</h1><p>不像其他语言使用分号结尾， Smalltalk 使用句号结尾。例如：</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| p | </span><br><span class="line">p := <span class="type">Client</span> new. </span><br><span class="line">p name: <span class="string">'Jack'</span>. </span><br><span class="line">p age: <span class="number">32.</span> </span><br><span class="line">p address: <span class="string">'Earth'</span>.</span><br></pre></td></tr></table></figure>
<p>但是 Smalltalk 里面也有分号，表示把消息发给上一个接收者，例如： </p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| p | </span><br><span class="line">p := <span class="type">Client</span> new. </span><br><span class="line">p name: <span class="string">'Jack'</span>;</span><br><span class="line">  age: <span class="number">32</span>;     </span><br><span class="line">  address: <span class="string">'Earth'</span>.</span><br></pre></td></tr></table></figure>
<p>可以更加省略： </p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| p | </span><br><span class="line">p := <span class="type">Client</span> new    </span><br><span class="line">  name: <span class="string">'Jack'</span>;     </span><br><span class="line">  age: <span class="number">32</span>;     </span><br><span class="line">  address: <span class="string">'Earth'</span>.</span><br></pre></td></tr></table></figure>
<p>首先，<code>new</code> 作为一个消息发送给类 <code>Client</code> （这里可以看出类也是一个对象），返回一个 <code>Client</code> 类的对象。其次，这个对象被发送消息 <code>name:</code> ，参数是 <code>’Jack‘</code>；随后分号表示舍弃掉返回值，接着把 <code>age:</code> 消息发送给上一个接收者。 最后 <code>address: &#39;Earth&#39;</code> 的结果被返回给 <code>p</code> 。一般来说一个 setter 方法会返回自己。（Smalltalk 方法必须有返回值）</p>
<h1 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h1><figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">| a b | </span><br><span class="line">a := <span class="type">OrderedCollection</span> new     </span><br><span class="line">  add: <span class="symbol">#red</span>;     </span><br><span class="line">  add: <span class="symbol">#green</span>;    </span><br><span class="line">  yourself. </span><br><span class="line">b := <span class="type">Dictionary</span> new     </span><br><span class="line">  at: <span class="symbol">#red</span> put: <span class="symbol">#rouge</span>;     </span><br><span class="line">  at: <span class="symbol">#green</span> put: <span class="symbol">#vert</span>;     </span><br><span class="line">  yourself.</span><br></pre></td></tr></table></figure>
<p>Smalltalk 中 <code>yourself</code> 返回接收者，而 <code>add:</code> 和 <code>at:put:</code> 返回最后一个参数。</p>
<p>key 和 value 可以是任意类型。</p>
<p>集合的读取：</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a at: <span class="number">1.</span></span><br><span class="line">b at: <span class="symbol">#red</span> .</span><br></pre></td></tr></table></figure>
<p>也可以通过迭代器进行遍历：</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a do: [:item |     </span><br><span class="line">  <span class="type">USE</span> item <span class="type">FOR</span> <span class="type">SOMETHING</span>]. </span><br><span class="line">b do: [:item |     </span><br><span class="line">  <span class="type">USE</span> item <span class="type">FOR</span> <span class="type">SOMETHING</span>].</span><br><span class="line">c := clients select: [:client | client netWorth &gt; <span class="number">500000</span>]. </span><br><span class="line">d := clients collect: [:client | client name].</span><br></pre></td></tr></table></figure>
<h1 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h1><p>如何写个迭代器，遍历 <code>Client</code> 对象中的 <code>name</code>，<code>age</code>，<code>address</code> 属性？ </p>
<p>Java 的做法：写个 <code>ClientIterator</code> 类，保存每次遍历到的状态。 </p>
<p>Smalltalk 的做法：代码块，即匿名函数。</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aClient partsDo: [:object | object printOn: <span class="type">Transcript</span>]</span><br><span class="line">partsDo: aBlock     </span><br><span class="line">  aBlock value: <span class="keyword">self</span> name.     </span><br><span class="line">  aBlock value: <span class="keyword">self</span> age.     </span><br><span class="line">  aBlock value: <span class="keyword">self</span> address.</span><br></pre></td></tr></table></figure>
<p>如何理解？此处抽象 <code>f(x) = print x</code> ， <code>partsDo</code> 接受这个函数作为参数。运行的时候，相当于运行了 <code>f(aClient.name)</code> , <code>f(aClient.age)</code> , <code>f(aClient.address)</code> 而不用关心 f 函数具体的内容是什么。</p>
<p>另一个例子，对飞机上小于 12 岁的乘客做处理：</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">anAirplane passengers do: [:person |     </span><br><span class="line">  person age &lt;= <span class="number">12</span>         </span><br><span class="line">    ifTrue: [..<span class="type">DO</span> <span class="type">SOMETHING</span> with person..]]</span><br></pre></td></tr></table></figure>
<p>可以更抽象出判断小于 12 岁的逻辑：</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kidsDo: aBlock    </span><br><span class="line">  <span class="keyword">self</span> passengers do: [:person |        </span><br><span class="line">    person age &lt;= <span class="number">12</span>             </span><br><span class="line">      ifTrue: [aBlock value: person]]</span><br><span class="line">      </span><br><span class="line">anAirplane kidsDo: [:kid |     </span><br><span class="line">  ..<span class="type">DO</span> <span class="type">SOMETHING</span> with kid..].</span><br></pre></td></tr></table></figure>
<p>需要注意的点：在代码块里 return 会回到最上层。举例：</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">findAnySickKid     </span><br><span class="line">  <span class="comment">"Here, self is an Airplane too. "</span>     </span><br><span class="line">  <span class="keyword">self</span> kidsDo: [:kid |         </span><br><span class="line">    kid isSick             </span><br><span class="line">      ifTrue: [^kid]].    </span><br><span class="line">  ^<span class="keyword">nil</span> <span class="comment">"None exists.”</span></span><br></pre></td></tr></table></figure>
<h1 id="类"><a href="#类" class="headerlink" title="类"></a>类</h1><figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> subclass: <span class="symbol">#MyClass</span>      </span><br><span class="line">  instanceVariableNames: <span class="string">''</span>      </span><br><span class="line">  classVariableNames: <span class="string">''</span>      </span><br><span class="line">  poolDictionaries: <span class="string">''</span>      </span><br><span class="line">  category: <span class="string">'Pupeno'</span></span><br></pre></td></tr></table></figure>
<h1 id="实现-if"><a href="#实现-if" class="headerlink" title="实现 if"></a>实现 if</h1><p>Smalltalk 中甚至不需要 if 关键字，因为我们可以自己实现。</p>
<p>首先，定义 true 和 false</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> subclass: <span class="symbol">#PBoolean</span>      </span><br><span class="line">  instanceVariableNames: <span class="string">''</span>      </span><br><span class="line">  classVariableNames: <span class="string">''</span>      </span><br><span class="line">  poolDictionaries: <span class="string">''</span>      </span><br><span class="line">  category: <span class="string">'Pupeno'</span></span><br><span class="line"><span class="type">PBoolean</span> subclass: <span class="symbol">#PTrue</span>      </span><br><span class="line">  instanceVariableNames: <span class="string">''</span>      </span><br><span class="line">  classVariableNames: <span class="string">''</span>      </span><br><span class="line">  poolDictionaries: <span class="string">''</span>      </span><br><span class="line">  category: <span class="string">'Pupeno'</span></span><br><span class="line"><span class="type">PBoolean</span> subclass: <span class="symbol">#PFalse</span>      </span><br><span class="line">  instanceVariableNames: <span class="string">''</span>      </span><br><span class="line">  classVariableNames: <span class="string">''</span>      </span><br><span class="line">  poolDictionaries: <span class="string">''</span>      </span><br><span class="line">  category: <span class="string">'Pupeno'</span></span><br></pre></td></tr></table></figure>
<p>定义 equals</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">equals: other  </span><br><span class="line">  ^ <span class="type">PTrue</span> new</span><br></pre></td></tr></table></figure>
<p>定义 ifTrue</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">"PTrue 中定义"</span></span><br><span class="line">ifTrue: do else: notdo  </span><br><span class="line">  ^ do value</span><br><span class="line">  </span><br><span class="line"><span class="comment">"PFalse 中定义"</span></span><br><span class="line">ifTrue: notdo else: do  </span><br><span class="line">  ^ do value</span><br></pre></td></tr></table></figure>
<p>最终效果：</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">m1 := <span class="type">MyClass</span> new.</span><br><span class="line">m2 := <span class="type">MyClass</span> new.</span><br><span class="line">(m1 equals: m2) ifTrue: [  </span><br><span class="line">  <span class="type">Transcript</span> show: <span class="string">'They are equal'</span></span><br><span class="line">] else: [  </span><br><span class="line">  <span class="type">Transcript</span> show: <span class="string">'They are false'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>和 Ruby 中的后置 if 有异曲同工之妙。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>Smalltalk 之所以看上去晦涩难懂，有很大一方面原因是它的符号与现代大多数编程语言不太一致。如果直接替换过来，就能好上很多。</p>
<p>另一方面，它追求纯粹的面向对象实现，真正的一切都是对象，交互都用发消息的形式体现，很多时候，对于习惯了现代编程语言的人们，也造成了一定的理解负担（谁能想到 if 还能这么实现）。稍作修改，便能受到人们的欢迎（Ruby）。</p>
<p>但 Smalltalk 是一门伟大的语言，它让你知道，原来代码还可以这么写，让你理解面向对象的本质。 C++ 和 Java 这种对面向对象的后天半吊子实现却占据了面向对象话语权的语言，对比之下就显得丑陋不堪了。 Smalltalk 还有着不分编译期和运行期这样的特性，不过现在对此体会也不是很深，就不多讲了。</p>
<p>写于 2018-08-02 凌晨</p>
</section>
    <section class="">
        <small>
        TAGS:&nbsp;
            <a class="tag-link" href="/tags/Smalltalk/">Smalltalk</a>
        
        </small>
    </section>
</article>

    <div id="vcomments"></div>
    <script src="//cdn1.lncld.net/static/js/3.7.3/av-min.js"></script>
    <script src="/Valine.min.js"></script>
    <script type="text/javascript">
        new Valine({
            el: '#vcomments',
            notify: true,
            verify: false,
            app_id: "KNr19IGaxOxhyEPC2OXwmlbK-gzGzoHsz",
            app_key: "6FKxDyP2jMSYNYCKbk71eevC",
            placeholder: "Say something...",
            avatar: 'retro',
            submail_appid: "13112",
            submail_appkey: "e66bb0bad3a54056d660664b3f044ff5",
            submail_template: "e1BUq2",
            post_title: "Smalltalk 入门学习"
        });
    </script>

      </main>
    </body>
    <footer role="contentinfo" class="center">
    <div id="site-links">
        <a href="/archives"><i class="icon-database" style="font-size: 15px"></i></a>
        <a href="mailto:lqn619@163.com" target="_blank" rel="external"><i class="icon-at"></i></a>
        <a href="https://github.com/maliut" target="_blank" rel="external"><i class="icon-github"></i></a>
        <a href="https://weibo.com/maliut" target="_blank" rel="external"><i class="icon-sina-weibo"></i></a>
        <a href="https://steamcommunity.com/id/maliut" target="_blank" rel="external"><i class="icon-steam"></i></a>
    </div>
    <p id="copyright">2019&nbsp;&copy;&nbsp;<a href="/">Mの综合研究</a>&nbsp;|&nbsp;Theme <a href="https://github.com/maliut/hexo-theme-simpow" title="SimPow" target="_blank" rel="noopener">SimPow</a></p>
</footer>
<script>
    console.log('Welcome!\nTheme SimPow inspired by Typescript & orzfly.com');
</script>
</html>