{"componentChunkName":"component---src-templates-post-js","path":"/p/react-leaflet-react-pixi/","result":{"data":{"markdownRemark":{"id":"1bcd971c-b897-534a-83f2-934b959feb31","excerpt":"ä¸€ç¯‡å®ç”¨æ€§çš„æ–‡ç« ï¼Œè®°å½•ä¸€ä¸‹æœ€è¿‘åœ¨è‡ªå¨±è‡ªä¹ä½¿ç”¨ Leaflet å’Œ PixiJS çš„è¿‡ç¨‹ä¸­æ•´çš„ä¸€ä¸ªæœ‰æ„æ€çš„æ´»ï¼Œå¸®åŠ©æˆ‘ä»¬ä½¿ç”¨ React å£°æ˜å¼çš„è¯­æ³•åœ¨ Leaflet çš„å›¾å±‚ä¸Šä½¿ç”¨ PixiJS ç»˜å›¾ã€‚ å¦‚æœä½ å¯¹è¿™äº›åº“å’Œå®ƒä»¬çš„ç”¨é€”éƒ½å·²æœ‰æ‰€äº†è§£ï¼Œåªæƒ³ç›´æ¥çœ‹ä»£ç çš„è¯ï¼Œå¯ä»¥ç›´æ¥è®¿é—® react-leaflet-reactâ€¦","html":"<p>ä¸€ç¯‡å®ç”¨æ€§çš„æ–‡ç« ï¼Œè®°å½•ä¸€ä¸‹æœ€è¿‘åœ¨è‡ªå¨±è‡ªä¹ä½¿ç”¨ Leaflet å’Œ PixiJS çš„è¿‡ç¨‹ä¸­æ•´çš„ä¸€ä¸ªæœ‰æ„æ€çš„æ´»ï¼Œå¸®åŠ©æˆ‘ä»¬ä½¿ç”¨ React å£°æ˜å¼çš„è¯­æ³•åœ¨ Leaflet çš„å›¾å±‚ä¸Šä½¿ç”¨ PixiJS ç»˜å›¾ã€‚</p>\n<p>å¦‚æœä½ å¯¹è¿™äº›åº“å’Œå®ƒä»¬çš„ç”¨é€”éƒ½å·²æœ‰æ‰€äº†è§£ï¼Œåªæƒ³ç›´æ¥çœ‹ä»£ç çš„è¯ï¼Œå¯ä»¥ç›´æ¥è®¿é—® <a href=\"https://github.com/maliut/react-leaflet-react-pixi\">react-leaflet-react-pixi</a>ï¼ˆç„¶åç‚¹ä¸ª star å†èµ°ï¼Œè°¢è°¢ğŸ‘€ï¼‰ã€‚</p>\n<!--more-->\n<h2>é¡¹ç›®åŠ¨æœº</h2>\n<p>é¡¹ç›®æ•´ä½“æ¡†æ¶ä½¿ç”¨äº† Reactã€‚ç”±äºéœ€è¦å¤§åœ°å›¾å±•ç¤ºçš„åŠŸèƒ½ï¼Œä¸€ç•ªè°ƒç ”ä»¥åå†³å®šé‡‡ç”¨ <a href=\"https://leafletjs.com/index.html\">Leaflet</a> æ¥å®ç°ã€‚Leaflet æ˜¯ä¸€ä¸ªç”¨äºå¿«é€Ÿæ„å»ºå¯äº¤äº’åœ°å›¾çš„ JS åº“ï¼Œå¼€ç®±å³ç”¨åœ°ä¸ºæˆ‘ä»¬æä¾›äº†åœ°å›¾ä¸­å„ç§å¸¸è§çš„äº¤äº’èƒ½åŠ›ï¼Œè¢«å¹¿æ³›åœ°ç”¨åœ¨ WebGIS é¢†åŸŸå½“ä¸­ã€‚</p>\n<p>ä¸è¿‡ä½œä¸ºä¸€ä¸ªçº¯ JavaScript çš„åº“ï¼Œleaflet ä¾ç„¶é‡‡ç”¨çš„æ˜¯å‘½ä»¤å¼çš„ APIï¼Œåœ¨ React ä¸­ä½¿ç”¨èµ·æ¥æ˜¾å¾—ä¹Ÿæ˜¯æ ¼æ ¼ä¸å…¥ï¼Œé¢‡ä¸ºè›‹ç–¼ã€‚æ‰€å¹¸çš„æ˜¯ï¼Œå·²ç»æœ‰äº† <a href=\"https://react-leaflet.js.org/\">React Leaflet</a> åº“èƒ½å¸®åŠ©æˆ‘ä»¬åœ¨ React ä¸­é€šè¿‡å£°æ˜å¼çš„è¯­æ³•æ¥ä½¿ç”¨ Leafletã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// pure leaflet è¯­æ³•</span>\n<span class=\"token keyword\">var</span> map <span class=\"token operator\">=</span> <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token string\">'map'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">51.505</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.09</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">tileLayer</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    attribution<span class=\"token operator\">:</span> <span class=\"token string\">'&amp;copy; &lt;a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap&lt;/a> contributors'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addTo</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">marker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">51.5</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.09</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addTo</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">bindPopup</span><span class=\"token punctuation\">(</span><span class=\"token string\">'A pretty CSS3 popup.&lt;br> Easily customizable.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n<span class=\"token comment\">// react-leaflet è¯­æ³•</span>\n<span class=\"token operator\">&lt;</span>MapContainer center<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token number\">51.505</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.09</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span> zoom<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">13</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>TileLayer\n    attribution<span class=\"token operator\">=</span><span class=\"token string\">'&amp;copy; &lt;a href=\"http://osm.org/copyright\">OpenStreetMap&lt;/a> contributors'</span>\n    url<span class=\"token operator\">=</span><span class=\"token string\">\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"</span>\n  <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>Marker position<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token number\">51.5</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.09</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Popup<span class=\"token operator\">></span><span class=\"token constant\">A</span> pretty <span class=\"token constant\">CSS3</span> popup<span class=\"token punctuation\">.</span> <span class=\"token operator\">&lt;</span>br <span class=\"token operator\">/</span><span class=\"token operator\">></span> Easily customizable<span class=\"token punctuation\">.</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Popup<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Marker<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>MapContainer<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>æˆ‘ä»¬åšä¸€ä¸ªåœ°å›¾ç±»çš„åº”ç”¨ï¼Œå¾€å¾€éœ€è¦åœ¨åœ°å›¾ä¸Šç»˜åˆ¶å„ç§æ ‡è®°ã€å›¾å½¢ç­‰ã€‚Leaflet æœ¬èº«å·²ç»æä¾›äº†è¿™äº›åŠŸèƒ½ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ marker åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºä¸€ä¸ªæ ‡è®°ï¼ˆå°±åƒä¸Šé¢çš„ä»£ç é‚£æ ·ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Pathã€Polygon ç­‰åŠŸèƒ½ç”»ä¸€äº›ç®€å•çš„å›¾å½¢ã€‚</p>\n<p>ä½†è¿™äº›ç»˜å›¾åŠŸèƒ½éƒ½æ¯”è¾ƒç®€å•ï¼Œå¾€å¾€æ»¡è¶³ä¸äº†æˆ‘ä»¬çš„éœ€è¦ã€‚æ›´é‡è¦çš„é—®é¢˜æ˜¯ï¼Œç»˜å›¾åŠŸèƒ½çš„é»˜è®¤åŸç†æ˜¯å‘ç½‘é¡µä¸­æ’å…¥æ–°çš„ DOMã€SVG ç­‰å…ƒç´ ï¼Œå¹¶åœ¨åœ°å›¾å‘ç”Ÿæ‹–åŠ¨ã€ç¼©æ”¾æ—¶ï¼ŒåŠ¨æ€æ”¹å˜å®ƒä»¬çš„ CSS æ ·å¼ã€‚å½“è¿™äº›å…ƒç´ å˜å¾—è¶Šæ¥è¶Šå¤šæ—¶ï¼Œç½‘é¡µå®¹æ˜“å˜å¾—å¡é¡¿ã€‚</p>\n<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ›´æœ‰æ•ˆç‡çš„æ–¹å¼æ¥ç»˜å›¾ã€‚ä¸éš¾æƒ³åˆ°å¯ä»¥ä½¿ç”¨ Canvas å®ç°ã€‚å½“ç„¶å¸‚é¢ä¸Šä¹Ÿæ—©å·²æœ‰äº†ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ <a href=\"https://github.com/eJuke/Leaflet.Canvas-Markers\">Leaflet.Canvas-Markers</a> ï¼Œ<a href=\"https://github.com/CartoDB/Leaflet.CanvasLayer\">Leaflet.CanvasLayer</a> ç­‰ç­‰ã€‚</p>\n<p>ä¸è¿‡æåˆ° 2D Canvas ç»˜å›¾ï¼Œæ˜¾ç„¶æœ‰ä¸ªæ›´å¥½çš„æ–¹æ¡ˆå°±æ˜¯ <a href=\"https://pixijs.com/\">PixiJS</a> ã€‚å®ƒä¸ä»…ä¸ºæˆ‘ä»¬å°è£…äº†ç¹ççš„ Canvas APIï¼Œæ›´èƒ½é€šè¿‡ WebGL çš„èƒ½åŠ›è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Œè¿˜è‡ªå¸¦äº†äº¤äº’å’ŒåŠ¨ç”»çš„èƒ½åŠ›ã€‚</p>\n<p>å½“ç„¶ï¼Œå’Œ Leaflet ä¸€æ ·ï¼ŒPixiJS é‡‡ç”¨çš„ä¹Ÿæ˜¯å‘½ä»¤å¼ APIï¼Œåœ¨ React ä¸­æ˜¾å¾—ä¸ç”šä¼˜é›…ã€‚ä¸è¿‡ä¹ŸåŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç°æˆçš„ <a href=\"https://reactpixi.org/\">React Pixi</a> åº“æ¥å¸®åŠ©æˆ‘ä»¬ä½¿ç”¨å£°æ˜å¼è¯­æ³•æ“ä½œ PixiJS ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// pure pixijs è¯­æ³•</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PIXI<span class=\"token punctuation\">.</span>Application</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> width<span class=\"token operator\">:</span> <span class=\"token number\">640</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">:</span> <span class=\"token number\">360</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>view<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> basicText <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PIXI<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Basic text in pixi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbasicText<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\nbasicText<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span>stage<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>basicText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// react-pixi è¯­æ³•</span>\n<span class=\"token operator\">&lt;</span>Stage width<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">640</span><span class=\"token punctuation\">}</span> height<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">360</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>Text x<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">50</span><span class=\"token punctuation\">}</span> y<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">100</span><span class=\"token punctuation\">}</span> text<span class=\"token operator\">=</span><span class=\"token string\">'Basic text in pixi'</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Stage<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>æœ€ç»ˆï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·ï¼Œè®© Leaflet èƒ½ä½¿ç”¨ PixiJS æ¥æ¸²æŸ“åœ°å›¾ä¸Šçš„å„ç§å›¾å½¢ã€‚åˆä¸€æ¬¡æˆ‘ä»¬æœ‰äº†ç°æˆçš„è½®å­ï¼š<a href=\"https://github.com/manubb/Leaflet.PixiOverlay\">Leaflet.PixiOverlay</a>ï¼Œå®ƒæ­å»ºèµ·äº† Leaflet åˆ° PixiJS ä¹‹é—´çš„æ¡¥æ¢ã€‚</p>\n<p>ä½†è¿™æ—¶é—®é¢˜å°±å‡ºç°äº†ã€‚Leaflet.PixiOverlay ä»¥å‘½ä»¤å¼çš„è¯­æ³•é™„åŠ åˆ° Leaflet æœ¬å°Šä¹‹ä¸Šï¼Œä¹Ÿè¦æ±‚æˆ‘ä»¬ä»¥å‘½ä»¤å¼çš„è¯­æ³•åœ¨å®ƒçš„ callback ä¸­è°ƒç”¨ PixiJS æ‰§è¡Œç»˜å›¾é€»è¾‘ã€‚åœ¨çº¯ JavaScript çš„ä¸–ç•Œä¸­è¿™æ— å¯åšéï¼Œä½†å¯¹äºæ—©å·²åœ¨é‡‡ç”¨äº†å£°æ˜å¼è¯­æ³•çš„ç°ä»£å‰ç«¯æ¡†æ¶ä¸­æµ¸æ·«äº†å¤šæ—¶çš„æˆ‘ä»¬æ¥è¯´ï¼Œç®€ç›´ä¸èƒ½å¿ã€‚</p>\n<p>æ˜æ˜å·²ç»æœ‰äº† React Leafletï¼Œåˆæœ‰äº† React Pixiï¼Œä¸¤ä¸ªç°æˆçš„è½®å­é‡åˆåœ¨ä¸€èµ·ï¼Œå¾—åˆ°çš„ï¼Œæœ¬è¯¥æ˜¯æ— é™ä¸æ»‘çš„å¼€å‘ä½“éªŒã€‚ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆä¼šå˜æˆè¿™æ ·å‘¢ï¼Ÿï¼ˆè¢«æ‹–èµ°</p>\n<p>ä¸ç®¡äº†ï¼Œæˆ‘å…¨éƒ½è¦ï¼</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 810px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/341cd1fe5e23448af65eaae007c6aa45/03073/cover.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.5615763546798%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIFAwT/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABTBe4qYUAr//EABkQAQEBAQEBAAAAAAAAAAAAAAIAAQMTIf/aAAgBAQABBQLObyWXy92bm1M41//EABYRAQEBAAAAAAAAAAAAAAAAAAASAf/aAAgBAwEBPwG9U//EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAgEBPwHKP//EABoQAAICAwAAAAAAAAAAAAAAAAABESEQEkH/2gAIAQEABj8Cb1axclM5LJZ//8QAGxABAAMBAQEBAAAAAAAAAAAAAQARMSFBUYH/2gAIAQEAAT8htCsbsXr6aMVaP5DW9+9nVdkVanuOf//aAAwDAQACAAMAAAAQdB//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8Qg2//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxBBH//EABkQAAMBAQEAAAAAAAAAAAAAAAERIQBxQf/aAAgBAQABPxApQZgG4bjUQ8CYTYxZlPBEw9+8jTmAcytb5roJhb//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cover\"\n        title=\"cover\"\n        src=\"/static/341cd1fe5e23448af65eaae007c6aa45/627f4/cover.jpg\"\n        srcset=\"/static/341cd1fe5e23448af65eaae007c6aa45/efcb5/cover.jpg 203w,\n/static/341cd1fe5e23448af65eaae007c6aa45/02e66/cover.jpg 405w,\n/static/341cd1fe5e23448af65eaae007c6aa45/627f4/cover.jpg 810w,\n/static/341cd1fe5e23448af65eaae007c6aa45/03073/cover.jpg 976w\"\n        sizes=\"(max-width: 810px) 100vw, 810px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<hr>\n<p>é—®é¢˜çš„æ ¸å¿ƒå°±åœ¨äºï¼Œæˆ‘ä»¬å¦‚ä½•èƒ½å°† Leaflet.PixiOverlay ä¸ React Leaflet å’Œ React Pixi ç»“åˆèµ·æ¥ï¼Œåœ¨å¼€å‘æ—¶å¯¹è¿™äº›ä¸‘é™‹çš„èƒ¶æ°´ä»£ç æ— æ„ŸçŸ¥ã€‚æˆ‘ä»¬ç†æƒ³çš„ä»£ç é•¿è¿™ä¸ªæ ·å­ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span><span class=\"token comment\">/* React Leaflet å°è£…çš„åœ°å›¾å®¹å™¨ */</span><span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span>MapContainer <span class=\"token operator\">...</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">{</span><span class=\"token comment\">/* åœ°å›¾çš„å›¾å±‚ */</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span>TileLayer <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">{</span><span class=\"token comment\">/* Pixi çš„å›¾å±‚ï¼Œå†…éƒ¨çš„ä¸œè¥¿éƒ½ä½¿ç”¨ PixiJS æ¸²æŸ“ */</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span>PixiRoot<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span><span class=\"token comment\">/* Pixi å›¾å±‚çš„å†…éƒ¨ï¼Œå¯ä»¥ç”¨ä»»ä½• React Pixi çš„ç»„ä»¶ç¼–å†™ */</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span>Text text<span class=\"token operator\">=</span><span class=\"token string\">\"marker\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Sprite <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PixiRoot<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>MapContainer<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ä¸‹é¢å°±è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥å®ç°å®ƒã€‚</p>\n<h2>ç»“åˆ React Leaflet</h2>\n<p>Leaflet.PixiOverlay ä¸ React Leaflet çš„ç»“åˆç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œå°±åƒ React ç»“åˆä»»ä½• JavaScript åº“ä¸€æ ·ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ React ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ/Hook ä¸­è°ƒç”¨è¿™äº›åº“çš„ç›¸åº” API ã€‚</p>\n<p>é¦–å…ˆæ­å»º React Leaflet ç¯å¢ƒï¼Œæœ¬æ–‡ä½¿ç”¨çš„ dependencies æ˜¯ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token property\">\"leaflet\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.7.1\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"react-leaflet\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.2.2\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\">// æ–‡ç« ç®€æ´èµ·è§ï¼Œä¸‹æ–‡ä¸­ç”¨åˆ°çš„ä¾èµ–ä¹Ÿåœ¨è¿™é‡Œä¸€å¹¶åˆ—å‡º</span>\n<span class=\"token property\">\"pixi.js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.2.0\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"leaflet-pixi-overlay\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.8.2\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"@inlet/react-pixi\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.6.5\"</span><span class=\"token punctuation\">,</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>éšåå†™ä¸€æ®µæœ€ç®€å•çš„ Demo ä»£ç ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MapContainer<span class=\"token punctuation\">,</span> TileLayer<span class=\"token punctuation\">,</span> Marker <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-leaflet'</span>\n<span class=\"token keyword\">import</span> <span class=\"token constant\">L</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'leaflet'</span>\n\n<span class=\"token keyword\">const</span> position <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">51.505</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.09</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>MapContainer center<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>position<span class=\"token punctuation\">}</span> zoom<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">13</span><span class=\"token punctuation\">}</span> style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> width<span class=\"token operator\">:</span> <span class=\"token string\">'100vw'</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">:</span> <span class=\"token string\">'100vh'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>TileLayer\n        attribution<span class=\"token operator\">=</span><span class=\"token string\">'&amp;copy; &lt;a href=\"http://osm.org/copyright\">OpenStreetMap&lt;/a> contributors'</span>\n        url<span class=\"token operator\">=</span><span class=\"token string\">\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"</span>\n      <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Marker position<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>position<span class=\"token punctuation\">}</span> icon<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">divIcon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> html<span class=\"token operator\">:</span> <span class=\"token string\">'æˆ‘æ˜¯ div icon'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>MapContainer<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>é…ç½®è¿‡ç¨‹ä¸­çš„æ³¨æ„ç‚¹ï¼š</p>\n<ol>\n<li>ä¸è¦å¿˜è®°å¼•å…¥ Leaflet çš„ cssï¼š<code class=\"language-text\">@import &#39;~leaflet/dist/leaflet.css&#39;</code></li>\n<li>React Leaflet æºç ä¸­ä½¿ç”¨åˆ°äº† <code class=\"language-text\">??</code> è¯­æ³•ï¼Œéœ€è¦é¢å¤–ä¸º babel é…ç½® <code class=\"language-text\">@babel/plugin-proposal-nullish-coalescing-operator</code> æ’ä»¶</li>\n</ol>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 810px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dd8c6ad1bed12bb589d6f35bbc7f104f/5bf79/base.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.26108374384237%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/klEQVQozw3H227TMAAA0Pz/D/CEeAMEYtomtV2bNpfmbufuxHZsJ27u7dqtIA0NAdLgvB2lZsbchiMLDsW6La2BB5T5NbYkidP9tkUOFiiMzQpox8KbORwOJO8iL9NAZiuPzDnTTV0ZDXMHvB95KMudzEzqLSjcXTmcY/1/D1UqGhIhh3eJXwRptu1noYx42x/g3AZPQ3iWaCJgELithETJUWRDZJ0QPEkyVflRoPPYVMTztN0Bg1pypWOOKN0y3tlZZpmqDeOCoOv0ndBXzl+64ZeQr4S+1PXPv7//vL29Dd1sGWZhrCegK0220/TFyjKZpIGjFokLAwcEZRa3TD734+X56cfxeHk8PQ7n6+X5KqfuIZGmB4mnK0MfOhFU9YWv3bi2ai6/YHh/9+7D6uunyN24sFinwi7xykcfjSgsAB/TGMNbn0YJUGZmRDm0zUXkrebKjZzVubbU959x4ibmPYsNKrlPmI9RVSGEaUQgreNlUlGSKkz4QZXGaIHADS8fMv0bxnYF9wPcTlj3wN4zFrwMQb5hJeAl5zxD9WGRCcZCRTTA9zcAqLWErKFgc0dC48LDztU6RvoOZZFlaUuXhAHbdoWBZJWJ5j6SCIcKLq3VThU1G+vklDo40Ircp7XoRXUpw+OQD1PdSqYub8PgQSRqT8EwleuiAXn+D9JB7Bw+EuejAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"base\"\n        title=\"base\"\n        src=\"/static/dd8c6ad1bed12bb589d6f35bbc7f104f/d7542/base.png\"\n        srcset=\"/static/dd8c6ad1bed12bb589d6f35bbc7f104f/2efce/base.png 203w,\n/static/dd8c6ad1bed12bb589d6f35bbc7f104f/1d180/base.png 405w,\n/static/dd8c6ad1bed12bb589d6f35bbc7f104f/d7542/base.png 810w,\n/static/dd8c6ad1bed12bb589d6f35bbc7f104f/5bf79/base.png 966w\"\n        sizes=\"(max-width: 810px) 100vw, 810px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>å¯ä»¥çœ‹åˆ°åœ°å›¾å’Œæ ‡è®°å·²ç»æˆåŠŸæ˜¾ç¤ºäº†å‡ºæ¥ï¼ˆæˆ‘ä¸ºæ ‡è®°å¢åŠ äº†ä¸€äº› CSS æ ·å¼ï¼Œè®©å®ƒå˜å¾—æ›´æ˜æ˜¾ï¼‰ã€‚é€šè¿‡å¼€å‘è€…å·¥å…·å¯ä»¥çœ‹åˆ°ï¼Œæ ‡è®°å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ div å…ƒç´ ã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼•å…¥ Leaflet.PixiOverlay ã€‚å®ƒçš„æ–‡æ¡£ä¸­å±•ç¤ºäº†å‘½ä»¤å¼çš„ç”¨æ³•ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> map <span class=\"token operator\">=</span> <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> pixiOverlay <span class=\"token operator\">=</span> <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">pixiOverlay</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">utils</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// your drawing code here</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PIXI<span class=\"token punctuation\">.</span>Container</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\npixiOverlay<span class=\"token punctuation\">.</span><span class=\"token function\">addTo</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ä¸éš¾çœ‹å‡º PixiOverlay ä¸ Leaflet é€šè¿‡ <code class=\"language-text\">map</code> å¯¹è±¡è¿æ¥åœ¨ä¸€èµ·ã€‚è€Œ React Leaflet æä¾›äº† <code class=\"language-text\">useMap()</code> hook ä¾›æˆ‘ä»¬è·å– <code class=\"language-text\">map</code> å¯¹è±¡ã€‚å› æ­¤ä¸€åˆ‡å°±é¡ºç†æˆç« äº†ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">PixiRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> map <span class=\"token operator\">=</span> <span class=\"token function\">useMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è·å– map å®ä¾‹ï¼Œæ¥è‡ª react-leaflet çš„ MapContainer</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    pixiOverlay<span class=\"token punctuation\">.</span><span class=\"token function\">addTo</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>map<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span> <span class=\"token comment\">// ä¸éœ€è¦æ¸²æŸ“ä»»ä½•ä¸œè¥¿ï¼ŒæŠŠå®ƒæ”¾åœ¨ MapContainer ç»„ä»¶å†…éƒ¨å³å¯</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>æˆ‘ä»¬å¯ä»¥åœ¨ PixiOverlay åˆå§‹åŒ–çš„å›è°ƒå‡½æ•°ä¸­è°ƒç”¨ PixiJS çš„ API ç”»å›¾ã€‚å½“åœ°å›¾ç§»åŠ¨å’Œç¼©æ”¾æ—¶ï¼ŒPixiOverlay ä¼šè°ƒç”¨æ­¤å›è°ƒå‡½æ•°é‡æ–°ç»˜å›¾ã€‚æ­¤å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥è°ƒç”¨ <code class=\"language-text\">redraw()</code> æ–¹æ³•æ‰‹åŠ¨è§¦å‘é‡ç»˜ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token string\">'leaflet-pixi-overlay'</span> <span class=\"token comment\">// Must be called before the 'leaflet' import</span>\n<span class=\"token keyword\">import</span> <span class=\"token constant\">L</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'leaflet'</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">PIXI</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'pixi.js'</span>\n\n<span class=\"token comment\">// æ„å»º Pixi å¯¹è±¡æ ‘çš„å±‚çº§</span>\n<span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PIXI<span class=\"token punctuation\">.</span>Container</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PIXI<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'æˆ‘æ˜¯ Pixi Text'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> fill<span class=\"token operator\">:</span> <span class=\"token number\">0xff1010</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\ncontainer<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> pixiOverlay <span class=\"token operator\">=</span> <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">pixiOverlay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">utils</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">getContainer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> renderer <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">getRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> project <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span>latLngToLayerPoint\n  <span class=\"token keyword\">const</span> scale <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">getScale</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> coords <span class=\"token operator\">=</span> <span class=\"token function\">project</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">51.505</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.08</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// éœ€è¦æŠŠç»çº¬åº¦è½¬æ¢ä¸º canvas ä¸Šçš„åæ ‡</span>\n  text<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> coords<span class=\"token punctuation\">.</span>x\n  text<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> coords<span class=\"token punctuation\">.</span>y\n  text<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> <span class=\"token string\">'æˆ‘æ˜¯ Pixi Text '</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n  text<span class=\"token punctuation\">.</span>scale<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> scale<span class=\"token punctuation\">)</span>\n\n  renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç»˜åˆ¶äº†ä¸€ä¸ª PIXI.Textï¼Œå¹¶åœ¨æ¯æ¬¡è§¦å‘é‡ç»˜æ—¶éšæœºæ”¹å˜å®ƒçš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¼€å‘è€…å·¥å…·çœ‹åˆ°å®ƒç¡®å®æ˜¯é€šè¿‡ PixiJS ä½¿ç”¨ WebGL æ¸²æŸ“åˆ° Canvas ä¸Šçš„ã€‚</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 810px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5dfa75b2436764d9b627e2a1ca5cfa5f/47218/pixi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.21674876847291%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAABYlAAAWJQFJUiTwAAACDklEQVQozx3O20+bUACAcf7vvS5ZsrjE7G1Pe3F7MjExGjerq5VisVKg5d6WWqBAz+EczoVrS51rlnzvv09YmaLviktTckb9hSmp6uNcFSNPWax0XOTv7+8U0QpnJWQVoFXGyi0pAWtI1VaNkM5fIlfxtWE4E7ExTB05WsxWnmaagySO9vs9wxiGW7qFdIsogAzmLEMM5BggQVfHtuuuF0bgavbDpaEN9Oc74/nu6c99EGzqpsEAwwSQnFB8LKc5ZYSwnHLGhZHUk3tXDz/PZFE0RMlRnhXx6ddwLM8diPO/h64kfFeXXd12Vb3/X9c0bdW2dSso4158/T3++GF6c27f/lY1Xe4PzPHYWb0kacDo0cFHCkFIc5wjSHKEEUAwo4QKM/lm+XKb3V+8OvJEGaiKNJ2PXEs1XTNMUsaLuq7q+rh/5Np2t+ecAwCzDKVpKrhy3zbkYG4BW49CY6rK/VHPM3v+Ug+TEGZ4k2aU8rKsu+5Q8AIhnBPe1C3GWFi6U9eU16E/s0ZrW8YbT58o11eX1rRPshAkr2nkZdsVSHxGj6tZWZAtQgFAmJeCH/qe9WgH40lsBSsNWZN04Uvy04PUByDl2Ctyt2bLXRm9deTtQN86yguYc9DuSiHwppY2DDZeGvvreBbFvqPKc2My06USprc/Lk4+ff765fT05PT829khJg0pdrTir2jPqn8ePwn3HAuXCQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pixi\"\n        title=\"pixi\"\n        src=\"/static/5dfa75b2436764d9b627e2a1ca5cfa5f/d7542/pixi.png\"\n        srcset=\"/static/5dfa75b2436764d9b627e2a1ca5cfa5f/2efce/pixi.png 203w,\n/static/5dfa75b2436764d9b627e2a1ca5cfa5f/1d180/pixi.png 405w,\n/static/5dfa75b2436764d9b627e2a1ca5cfa5f/d7542/pixi.png 810w,\n/static/5dfa75b2436764d9b627e2a1ca5cfa5f/d56b5/pixi.png 1215w,\n/static/5dfa75b2436764d9b627e2a1ca5cfa5f/47218/pixi.png 1344w\"\n        sizes=\"(max-width: 810px) 100vw, 810px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>PixiJS ä¹Ÿæä¾›äº† Devtools ç”¨äºæŸ¥çœ‹ PixiJS å¯¹è±¡æ ‘ã€‚ä½†æœ‰ä¸ªå‘ç‚¹æ˜¯ï¼Œå®ƒæ˜¯é€šè¿‡æ£€æµ‹ <code class=\"language-text\">window.PIXI</code> å¯¹è±¡æ¥åˆ¤æ–­é¡µé¢æ˜¯å¦ä½¿ç”¨ PixiJS çš„ï¼Œå› æ­¤åœ¨ç°ä»£å‰ç«¯é¡¹ç›®ä¸­ï¼Œä½ éœ€è¦åœ¨ä»£ç ä¸­æ‰‹å·¥å®šä¹‰ <code class=\"language-text\">window.PIXI = PIXI</code> ã€‚</p>\n</blockquote>\n<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆšå¼€å§‹å°±æŠŠ PixiJS çš„å¯¹è±¡æ ‘ç»™å»ºç«‹å¥½äº†ï¼Œè€Œæ¯æ¬¡é‡ç»˜åªæ˜¯ä¿®æ”¹äº† Text çš„å±æ€§ã€‚ä½†åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œå¯¹è±¡æ ‘çš„å±‚çº§ã€ä»¥åŠæ¶‰åŠå­å…ƒç´ çš„å¢åˆ æ”¹ä¼šå¤æ‚è®¸å¤šã€‚å¦‚æœæ¯æ¬¡çš„å˜åŒ–éƒ½éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥ç®¡ç†ï¼Œè¿˜æ˜¯å¾ˆéº»çƒ¦çš„ã€‚è¿™å…¶å®å’Œæˆ‘ä»¬æ‰‹åŠ¨æ“ä½œ DOM æ ‘é‡åˆ°çš„é—®é¢˜æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ç”¨å£°æ˜å¼çš„è¯­æ³•æ¥å†™ PixiJS ã€‚</p>\n<p>é‚£ä¹ˆä¸‹é¢å°±æ¥ç»§ç»­æ¢ç´¢å¦‚ä½•ç»“åˆ React Pixi ã€‚</p>\n<h2>ç»“åˆ React Pixi</h2>\n<p>ç»“åˆ React Pixi å°±æ²¡æœ‰å‰é¢é‚£ä¹ˆå®¹æ˜“äº†ã€‚æˆ–è®¸æˆ‘ä»¬ä¼šæƒ³èƒ½ä¸èƒ½ç›´æ¥æŠŠ React Pixi çš„å†…å®¹æ¸²æŸ“åˆ° <code class=\"language-text\">MapContainer</code> å†…éƒ¨ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">  <span class=\"token operator\">&lt;</span>MapContainer <span class=\"token operator\">...</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>TileLayer <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span><span class=\"token comment\">/* Stage æ˜¯ React Pixi çš„æ ¹èŠ‚ç‚¹ */</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span>Stage width<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">300</span><span class=\"token punctuation\">}</span> height<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">300</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Sprite\n        image<span class=\"token operator\">=</span><span class=\"token string\">\"https://s3-us-west-2.amazonaws.com/s.cdpn.io/693612/coin.png\"</span>\n        scale<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> x<span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">:</span> <span class=\"token number\">0.5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        anchor<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">}</span>\n        x<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">150</span><span class=\"token punctuation\">}</span>\n        y<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">150</span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Stage<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>MapContainer<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ä½†è¿è¡Œåä¼šå‘ç° React Pixi çš„å†…å®¹è¢« Leaflet åœ°å›¾é®æŒ¡ï¼Œä¸”å¹¶ä¸ä¼šéšç€åœ°å›¾çš„å¹³ç§»å’Œç¼©æ”¾æ¥æ”¹å˜è‡ªå·±ã€‚è¿™æ˜¯å› ä¸ºï¼ŒLeaflet çš„å›¾å±‚ä½“ç³»å¸®åŠ©æˆ‘ä»¬åšäº†è¿™äº›äº‹æƒ…ï¼Œè€Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬ç®€å•æŠŠä¸œè¥¿æ”¾åœ¨ Leaflet çš„å±‚çº§å†…éƒ¨å°±èƒ½äº«å—åˆ°çš„ã€‚</p>\n<p>é€šè¿‡å®¡æŸ¥å…ƒç´ ï¼Œå¯ä»¥å‘ç°ç”¨è¿™ç§æ–¹å¼åˆ›å»ºçš„ Canvasï¼Œå®Œå…¨æ¸¸ç¦»åœ¨ Leaflet çš„ä½“ç³»ä¹‹å¤–ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"çº¯æ–‡æœ¬\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-çº¯æ–‡æœ¬ line-numbers\"><code class=\"language-çº¯æ–‡æœ¬\">leaflet-container\nâ”œâ”€ leaflet-map-pane\nâ”‚  â”œâ”€ leaflet-tile-pane         &lt;-- åœ°å›¾å›¾å—æ‰€åœ¨å±‚çº§\nâ”‚  â”œâ”€ ... çœç•¥å…¶ä»–å±‚çº§\nâ”‚  â””â”€ leaflet-overlay-pane\nâ”‚     â””â”€ leaflet-pixi-overlay   &lt;-- Leaflet.PixiOverlay æ‰€åœ¨å±‚çº§\nâ”‚        â””â”€ canvas              &lt;-- Leaflet.PixiOverlay åˆ›å»ºçš„ Canvas\nâ”œâ”€ leaflet-control-container\nâ””â”€ canvas                       &lt;-- React Pixi åˆ›å»ºçš„ Canvas</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>å®è·µä¸­è¿˜è¦æ³¨æ„çš„ä¸€ä¸ªç±»ä¼¼é—®é¢˜ï¼šReact Pixi &#x3C;Stage> ä¹‹ä¸‹çš„ç»„ä»¶æ˜¯æ¸²æŸ“åœ¨å¦ä¸€ä¸ª Root ä¸‹é¢çš„ã€‚å› æ­¤å‡å¦‚é…åˆå…¨å±€ Provider ä½¿ç”¨ï¼ˆä¾‹å¦‚ä½¿ç”¨ Reduxã€MobX ç­‰å…¨å±€çŠ¶æ€ç®¡ç†å·¥å…·ï¼‰ï¼Œéœ€è¦åœ¨ &#x3C;Stage> å†…éƒ¨å†å¥—ä¸€å±‚ &#x3C;Provider></p>\n</blockquote>\n<p>æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¸éš¾æƒ³åˆ°ä¸¤ç§è§£å†³é€”å¾„ã€‚ç¬¬ä¸€ç§æ–¹æ³•æ˜¯å°½é‡èå…¥ Leaflet çš„ä½“ç³»ï¼Œæƒ³åŠæ³•æŠŠ React Pixi åˆ›å»ºçš„å†…å®¹æ¸²æŸ“åˆ° Leaflet å†…éƒ¨çš„ Canvas ä¸­ã€‚ç¬¬äºŒç§æ–¹æ³•åˆ™æ˜¯ç»´æŒ React Pixi çš„ç”¨æ³•ä¸å˜ï¼Œä½†æŠŠ Leaflet å±‚çº§äº¤äº’çš„ç›¸å…³é€»è¾‘æŠ½å–å‡ºæ¥ï¼Œæ‰‹åŠ¨æ§åˆ¶ Canvas ä½ç½®å’Œç¼©æ”¾ä¸ Leaflet åœ°å›¾åŒæ­¥ã€‚</p>\n<p>ç†è®ºä¸Šä¸¤ç§æ–¹æ³•éƒ½æ˜¯å¯è¡Œçš„ï¼Œé‚£å°±å¾—çœ‹å“ªç§æ–¹æ³•åšèµ·æ¥æ›´æ–¹ä¾¿ã€‚é€šè¿‡ä¸€ç•ªæŸ¥æ‰¾æ–‡æ¡£åï¼Œæˆ‘çœ‹åˆ° React Pixi æä¾›äº†ä¸€ä¸ª<a href=\"https://reactpixi.org/render\">ç‹¬ç«‹çš„ render æ–¹æ³•</a>ï¼Œå¯ä»¥ç»•è¿‡æ•´ä¸ªä½“ç³»ï¼Œç›´æ¥æŠŠ JSX æ ¼å¼çš„ä»£ç æ¸²æŸ“åˆ°ä¸€ä¸ª PIXI.Container ä¸­ã€‚è¿™ä½¿å¾—å®ç°ä¸Šè¿°ç¬¬ä¸€ç§æ–¹æ³•çš„è·¯å¾„ä¸€ä¸‹å­æ¸…æ™°äº†èµ·æ¥ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Text text<span class=\"token operator\">=</span><span class=\"token string\">\"Hello World\"</span> x<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">200</span><span class=\"token punctuation\">}</span> y<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">200</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">.</span>stage<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>é‚£ä¹ˆè¿™ä¸ª <code class=\"language-text\">render</code> æ–¹æ³•åšäº†ä»€ä¹ˆå‘¢ï¼Ÿä¸€å¼€å§‹æˆ‘ä»¥ä¸ºå®ƒçš„ä½œç”¨æ˜¯æ¸²æŸ“å½“å‰ JSX å¯¹åº”çš„ç”»é¢ï¼Œä½†æŠŠå®ƒæ”¾åˆ°ä»£ç ä¸­ï¼Œè°ƒç”¨ä¹‹åå´ä¸€ç‚¹ååº”éƒ½æ²¡æœ‰ã€‚æ˜¯æˆ‘çš„å§¿åŠ¿ä¸å¯¹å—ï¼Ÿæ–‡æ¡£é‡Œå·²ç»æ²¡æœ‰æ›´å¤šä¿¡æ¯äº†ï¼Œåªå¥½æ‰“å¼€æºç ä¸€çœ‹ç©¶ç«Ÿã€‚</p>\n<p><code class=\"language-text\">render</code> æ–¹æ³•çš„æºç ååˆ†ç®€å•ï¼Œæ ¸å¿ƒé€»è¾‘å°±æ˜¯ä¸€è¡Œä»£ç ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">callback</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  PixiFiber<span class=\"token punctuation\">.</span><span class=\"token function\">updateContainer</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ç»§ç»­æŸ¥çœ‹ <code class=\"language-text\">PixiFiber</code> çš„å®ç°ï¼Œè¿™æ¬¡åˆ™æ›´ä¸ºç®€å•ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> PixiFiber <span class=\"token operator\">=</span> <span class=\"token function\">Reconciler</span><span class=\"token punctuation\">(</span>hostconfig<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>è™½ç„¶ä¼¼ä¹ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯éƒ½æ²¡æœ‰ï¼Œä½†å½“çœ‹åˆ° <code class=\"language-text\">Reconciler</code> è¿™ä¸ªè¯æ—¶æƒ³å¿…å¿ƒé‡Œå·²ç»æ˜ç™½äº†ä¸ƒä¸ƒå…«å…«ã€‚å¯¹ React æ¶æ„ç¨æœ‰äº†è§£çš„äººéƒ½ä¼šçŸ¥é“ Reconciler æ˜¯ React çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ï¼Œè´Ÿè´£ Fiber æ ‘çš„ç”Ÿæˆå’Œæ›´æ–°ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åˆç†æ¨æµ‹ React Pixi çš„ <code class=\"language-text\">render</code> æ–¹æ³•åšçš„ä¹Ÿæ˜¯ç±»ä¼¼çš„äº‹æƒ…ï¼Œå³å°† JSX è½¬æ¢ä¸º PixiJS çš„å¯¹è±¡æ ‘ï¼ˆå®˜æ–¹ç§°ä¸º <a href=\"https://pixijs.io/guides/basics/scene-graph.html\">Scene Graph</a>ï¼‰ã€‚</p>\n<p>æ—¢ç„¶å·²ç»ç”Ÿæˆäº† Scene Graphï¼Œæ¥ä¸‹æ¥ç›´æ¥è°ƒç”¨çœŸæ­£çš„æ¸²æŸ“å™¨å°†å…¶æ¸²æŸ“ä¸ºç”»é¢å°±å®Œäº‹äº†ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PIXI<span class=\"token punctuation\">.</span>Container</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> pixiOverlay <span class=\"token operator\">=</span> <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">pixiOverlay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">utils</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">getContainer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> renderer <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">getRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> project <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span>latLngToLayerPoint\n  <span class=\"token keyword\">const</span> scale <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">getScale</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> coords <span class=\"token operator\">=</span> <span class=\"token function\">project</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">51.505</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.08</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// å°† JSX æ¸²æŸ“ä¸ºä»¥ container ä¸ºæ ¹èŠ‚ç‚¹çš„ PixiJS å¯¹è±¡æ ‘</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Text x<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>coords<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">}</span> y<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>coords<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">}</span> text<span class=\"token operator\">=</span><span class=\"token string\">'æˆ‘æ˜¯ Pixi Text'</span> scale<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> scale<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// å°† PixiJS å¯¹è±¡æ ‘çœŸæ­£æ¸²æŸ“ä¸ºç”»é¢</span>\n  renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>æˆåŠŸäº†ï¼</p>\n<p>ï¼ˆå›¾å’Œä¸Šé¢ä¸€æ ·ï¼Œå°±ä¸æ”¾äº†ï¼‰</p>\n<hr>\n<p>ä¸è¿‡èƒ½æ¸²æŸ“ JSX åªæ˜¯æˆåŠŸçš„ç¬¬ä¸€æ­¥ã€‚å¯¹æ¯”äºç†æƒ³æƒ…å†µï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›å½»åº•æŠŠ <code class=\"language-text\">pixiOverlay</code> å°è£…èµ·æ¥ï¼Œä¸è¢«å¤–ç•Œæ„ŸçŸ¥ï¼›ä»¥åŠè®© React Pixi çš„ JSX å’Œæ­£å¸¸çš„ React ç»„ä»¶ä¸€æ ·ï¼Œè‡ªç”±åœ°ä½¿ç”¨å„ç§å„æ ·çš„ Hooksã€‚</p>\n<p>æˆ‘ä»¬ä¾ç„¶æŠŠå¤æ‚åº¦å°è£…åœ¨ä¸ŠèŠ‚ä¸­å·²ç»åˆ›å»ºçš„ <code class=\"language-text\">PixiRoot</code> ç»„ä»¶ä¸­ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PIXI<span class=\"token punctuation\">.</span>Container</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">PixiRoot</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  \n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>children<span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>children<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ç°åœ¨è¿™ä¸ªç»„ä»¶æ„ŸçŸ¥å®ƒå†…éƒ¨çš„ children å³ React Pixi çš„ JSXã€‚å½“ children å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡å‰¯ä½œç”¨å°†å…¶è½¬å˜æˆå¯¹åº”çš„ PixiJS å¯¹è±¡æ ‘ã€‚</p>\n<p>å›åˆ° React Pixi çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç”Ÿæˆæ–°çš„å¯¹è±¡æ ‘çš„ Diff ç®—æ³•ä¸­ï¼Œå¦‚æœæ£€æµ‹åˆ°æ›´æ–°ï¼Œå°±ä¼šæŠ›å‡ºåä¸º <code class=\"language-text\">REACT_PIXI_REQUEST_RENDER</code> çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œæ˜æ˜¾æ˜¯ä¸ºäº†è¯·æ±‚è§¦å‘é‡æ–°æ¸²æŸ“ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token function\">appendInitialChild</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token function\">appendChild</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomEvent</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">__REACT_PIXI_REQUEST_RENDER__</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> detail<span class=\"token operator\">:</span> <span class=\"token string\">'appendInitialChild'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> res\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶æ¥è§¦å‘ç”»é¢çš„é‡æ–°æ¸²æŸ“ã€‚ä¹‹æ‰€ä»¥ä¸åœ¨ä¸Šä¸€æ­¥è°ƒç”¨ <code class=\"language-text\">render</code> æ–¹æ³•ä¹‹åç›´æ¥è°ƒç”¨é‡æ–°æ¸²æŸ“ï¼Œæ˜¯å› ä¸º children å†…éƒ¨å­å…ƒç´ çš„å˜åŒ–å¹¶ä¸ä¼šè§¦å‘çˆ¶å…ƒç´ çš„æ›´æ–°ï¼Œä½†è‡ªå®šä¹‰äº‹ä»¶æ˜¯å§‹ç»ˆä¼šè§¦å‘çš„ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> requestUpdate <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  pixiOverlay<span class=\"token punctuation\">.</span><span class=\"token function\">redraw</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'__REACT_PIXI_REQUEST_RENDER__'</span><span class=\"token punctuation\">,</span> requestUpdate<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'__REACT_PIXI_REQUEST_RENDER__'</span><span class=\"token punctuation\">,</span> requestUpdate<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>requestUpdate<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ä¸Šé¢çš„ä»£ç åœ¨ç›‘å¬åˆ°è‡ªå®šä¹‰äº‹ä»¶åç«‹å³è°ƒç”¨äº† <code class=\"language-text\">redraw</code> æ–¹æ³•ï¼Œè¿›è€Œè§¦å‘ <code class=\"language-text\">pixiOverlay</code> çš„å›è°ƒå‡½æ•°ã€‚åœ¨å›è°ƒå‡½æ•°ä¸­æˆ‘ä»¬åªéœ€ä¿ç•™ <code class=\"language-text\">renderer.render(container)</code> è¿™ä¸€å¥ï¼Œå°†å…¶çœŸæ­£æ¸²æŸ“ä¸ºç”»é¢å°±å¯ä»¥äº†ã€‚</p>\n<p>è¿™æ ·åšå¯è¡Œï¼Œä½†å­˜åœ¨ç€é‡å¤æ¸²æŸ“çš„é—®é¢˜ã€‚å¦‚æœ Diff è¿‡ç¨‹ä¸­ <code class=\"language-text\">REACT_PIXI_REQUEST_RENDER</code> äº‹ä»¶è¢«å¤šæ¬¡è§¦å‘ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨å¤šæ¬¡ <code class=\"language-text\">redraw</code>ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚ä¸€èˆ¬åœ¨è¿™ç§é‡ç»˜å›¾å’ŒåŠ¨ç”»çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ <code class=\"language-text\">requestAnimationFrame</code> æ¥å®ç°æ¸²æŸ“é€»è¾‘ï¼Œä»¥ä½¿å¾—æ¸²æŸ“é€»è¾‘ä¸å±å¹•åˆ·æ–°ä¿æŒæ­¥è°ƒä¸€è‡´ã€‚</p>\n<blockquote>\n<p>æƒ³ç”¨å¥½ <code class=\"language-text\">requestAnimationFrame</code> å¹¶ä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹ã€‚æ— è®ºæ–°æ‰‹è¿˜æ˜¯è€æ‰‹ï¼Œæˆ‘éƒ½æ¨èé˜…è¯»<a href=\"/p/javascript-game-loop/\">æˆ‘ä¹‹å‰ç¿»è¯‘çš„ä¸€ç¯‡æ–‡ç« </a>ï¼Œå®ƒéå¸¸è¯¦ç»†åœ°è®²è§£äº†ä½ å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚</p>\n</blockquote>\n<p>PixiJS æŠŠåŸç”Ÿçš„ <code class=\"language-text\">requestAnimationFrame</code> å°è£…ä¸ºäº† Ticker æ¨¡å—ã€‚æˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ªæ˜¯å¦éœ€è¦é‡ç»˜çš„ flagï¼Œåœ¨æ¯æ¬¡ tick æ—¶é€šè¿‡åˆ¤æ–­ flag å†çœŸæ­£è§¦å‘é‡ç»˜ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦éœ€è¦é‡ç»˜çš„ flag</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>needsRenderUpdate<span class=\"token punctuation\">,</span> setNeedsRenderUpdate<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// å½“è§¦å‘ __REACT_PIXI_REQUEST_RENDER__ äº‹ä»¶æ—¶ï¼Œä¸ç«‹å³é‡ç»˜ï¼Œè€Œæ˜¯ç‚¹äº® flag</span>\n<span class=\"token keyword\">const</span> requestUpdate <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setNeedsRenderUpdate</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// åœ¨æ¯æ¬¡ tick æ—¶åˆ¤æ–­ flag æ¥å†³å®šæ˜¯å¦çœŸæ­£è§¦å‘é‡ç»˜</span>\n<span class=\"token keyword\">const</span> renderStage <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>needsRenderUpdate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setNeedsRenderUpdate</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    pixiOverlay<span class=\"token punctuation\">.</span><span class=\"token function\">redraw</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>needsRenderUpdate<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> ticker <span class=\"token operator\">=</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Ticker<span class=\"token punctuation\">.</span>shared\n  ticker<span class=\"token punctuation\">.</span>autoStart <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n  ticker<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>renderStage<span class=\"token punctuation\">)</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'__REACT_PIXI_REQUEST_RENDER__'</span><span class=\"token punctuation\">,</span> requestUpdate<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    ticker<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>renderStage<span class=\"token punctuation\">)</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'__REACT_PIXI_REQUEST_RENDER__'</span><span class=\"token punctuation\">,</span> requestUpdate<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>renderStage<span class=\"token punctuation\">,</span> requestUpdate<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>è¿™æ ·ä¸€ä¸ªç›¸å¯¹å®Œå–„çš„æ¸²æŸ“é€»è¾‘å°±å®Œæˆäº†ã€‚è®©æˆ‘ä»¬å†™ä¸ªç®€å•çš„ Demo æ¥éªŒè¯ä¸‹æ•ˆæœæ˜¯å¦ä¸æˆ‘ä»¬çš„é¢„æœŸä¸€è‡´ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">MyContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>flag<span class=\"token punctuation\">,</span> setFlag<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Container x<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">65506</span><span class=\"token punctuation\">}</span> y<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">43586</span><span class=\"token punctuation\">}</span> scale<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">16</span><span class=\"token punctuation\">}</span> interactive<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span> click<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setFlag</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Text text<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>flag <span class=\"token operator\">?</span> <span class=\"token string\">'Pixi Text'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'Text Changed'</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>flag <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">&lt;</span>Sprite y<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">50</span><span class=\"token punctuation\">}</span> image<span class=\"token operator\">=</span><span class=\"token string\">\"https://s3-us-west-2.amazonaws.com/s.cdpn.io/693612/IaUrttj.png\"</span><span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Container<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>MapContainer <span class=\"token operator\">...</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>TileLayer <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>PixiRoot<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>MyContent <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PixiRoot<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>MapContainer<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><img src=\"/2ab8f9c9ac98ac7dc9018b01b92d18b3/3.gif\" alt=\"Demo\"></p>\n<p>æˆ‘ä»¬ç»ˆäºæŠŠå¤æ‚åº¦éšè—äº†èµ·æ¥ï¼Œä½¿å¾— React Leaflet ä¸ React Pixi çš„ç»“åˆå°±åƒå†™åŸç”Ÿ React é‚£æ ·è‡ªç„¶ï¼Œå¹¶ä¸”å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨ Hooks ç­‰èƒ½åŠ›ã€‚æˆ‘ä»¬æˆåŠŸäº†ï¼ä½†è¿˜æœ‰æœ€åä¸€ç‚¹é—æ†¾ï¼Œåœ¨ä¸Šä¾‹ä¸­ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œç»„ä»¶çš„åæ ‡å’Œç¼©æ”¾çš„å€¼éƒ½æ˜¯å†™æ­»çš„å¥‡æ€ªçš„å€¼ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨ <code class=\"language-text\">pixiOverlay</code> è¢«å°è£…èµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•è°ƒç”¨å®ƒçš„æŠ•å½±å‡½æ•°åŠ¨æ€åœ°æŠŠç»çº¬åº¦è½¬æ¢ä¸º Canvas åæ ‡äº†ã€‚è¿™åœ¨çœŸå®é¡¹ç›®ä¸­å¯ä¸èƒ½æ¥å—ã€‚ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°±æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>\n<h2>æ³¨å…¥ä¸Šä¸‹æ–‡</h2>\n<p>æˆ‘ä»¬éœ€è¦å‘å­ç»„ä»¶ä¸­æ³¨å…¥ä¸€äº›è¯¸å¦‚åæ ‡è½¬æ¢ã€ç¼©æ”¾ç­‰å¿…è¦çš„ä¿¡æ¯ä¸å·¥å…·å‡½æ•°ã€‚ä¸éš¾æƒ³åˆ°å¯ä»¥ç”¨ React çš„ Context æœºåˆ¶é…åˆè‡ªå®šä¹‰ Hook æ¥å®Œæˆã€‚ä¸‹é¢å°±åˆ†åˆ«æ¥å®ç°å®ƒä»¬ã€‚</p>\n<h3>åæ ‡è½¬æ¢</h3>\n<p>å¯¹äºåœ°å›¾ä¸Šçš„ç‰©ä½“ï¼Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒå®ƒçš„ç»çº¬åº¦ï¼Œä½† PixiJS éœ€è¦çš„æ˜¯å®ƒä»¬åœ¨ Canvas ä¸Šçš„åæ ‡ã€‚Leaflet.PixiOverlay æä¾›äº† <code class=\"language-text\">utils.latLngToLayerPoint</code> å‡½æ•°å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™ä¸€åæ ‡è½¬æ¢ã€‚å¦å¤–è¦æ³¨æ„çš„æ˜¯ï¼ŒPixiJS å…ƒç´ çš„åæ ‡æ˜¯ç›¸å¯¹äºå®ƒä»¬çš„çˆ¶å…ƒç´ çš„ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬è‡ªé¡¶å‘ä¸‹åœ°é€çº§è®¡ç®—æ¯ä¸ªå…ƒç´ çš„åæ ‡ï¼Œå†å‡å»çˆ¶å…ƒç´ çš„åæ ‡ã€‚</p>\n<p>åŸºäºä»¥ä¸ŠåŸåˆ™ï¼Œå¯ä»¥è®¾è®¡å‡ºåæ ‡è½¬æ¢çš„ Hookï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Context <span class=\"token operator\">=</span> <span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useProject</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">latlng<span class=\"token punctuation\">,</span> parentPosition <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// project å°±æ˜¯ utils.latLngToLayerPoint</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> project <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>Context<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> myPosition <span class=\"token operator\">=</span> <span class=\"token function\">project</span><span class=\"token punctuation\">(</span>latlng<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// è¿”å›å€¼å°±æ˜¯åº”è¯¥è¢«å¡«å…¥ PixiJS å…ƒç´ çš„ xy å€¼</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>myPosition<span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> parentPosition<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> myPosition<span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> parentPosition<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3>ç¼©æ”¾æ„ŸçŸ¥</h3>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLeaflet.PixiOverlay å·²ç»ä¸ºæˆ‘ä»¬åšå¥½äº†ç¼©æ”¾çš„é€»è¾‘ï¼Œå½“åœ°å›¾ç¼©æ”¾æ—¶ï¼Œä¸Šé¢ç»˜åˆ¶çš„ç‰©ä½“ä¹Ÿä¼šéšä¹‹ç¼©æ”¾ã€‚ä½†æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›åœ°å›¾ä¸Šçš„æ ‡è®°åœ¨åœ°å›¾ç¼©æ”¾æ—¶ä¿æŒå¤§å°ä¸å˜ï¼Œè¿™å°±éœ€è¦èƒ½æ„ŸçŸ¥å½“å‰çš„ç¼©æ”¾å¹¶ä½œåå‘çš„å“åº”ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä¸­ç»´æŠ¤å½“å‰çš„ç¼©æ”¾å€¼ã€‚å½“åœ°å›¾å‘ç”Ÿç¼©æ”¾æ—¶ï¼Œå¿…å®šä¼šè§¦å‘ <code class=\"language-text\">pixiOverlay</code> çš„å›è°ƒï¼Œé‚£ä¹ˆæ­£å¥½åœ¨å›è°ƒä¸­æ›´æ–°æœ€æ–°çš„ç¼©æ”¾å€¼ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æŠŠ <code class=\"language-text\">pixiOverlay</code> ä¹Ÿæ”¾åˆ° <code class=\"language-text\">PixiRoot</code> ç»„ä»¶ä¸­ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// in PixiRoot Component</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>scale<span class=\"token punctuation\">,</span> setScale<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>pixiOverlay<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">PIXIOverlay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">utils</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">getContainer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> renderer <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">getRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// æ›´æ–°å½“å‰çš„ scale</span>\n  <span class=\"token function\">setScale</span><span class=\"token punctuation\">(</span>utils<span class=\"token punctuation\">.</span><span class=\"token function\">getScale</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// æœ¬èŒå·¥ä½œï¼šæ¸²æŸ“ç”»é¢</span>\n  renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ç„¶åæä¾›ä¸€ä¸ª Hook è·å–æœ€æ–°ç¼©æ”¾å€¼ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useScale</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> scale <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>Context<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> scale\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3>useTick</h3>\n<p>æˆ‘ä»¬å¾€å¾€éœ€è¦åšä¸€äº›åŠ¨ç”»æ•ˆæœã€‚ä¸Šæ–‡å·²ç»æåˆ°ï¼Œå¯ä»¥ä½¿ç”¨ PixiJS çš„ Ticker æ¨¡å—ã€‚åœ¨ React ä¸­ï¼Œä¸ºäº†æ›´åŠ æ–¹ä¾¿åœ°ä½¿ç”¨ï¼Œå¯ä»¥å°† Ticker çš„å‘½ä»¤å¼ API å°è£…ä¸º <code class=\"language-text\">useTick</code> Hookã€‚</p>\n<p>React Pixi ä¸­å·²ç»æä¾›äº†è¿™ä¸ª Hookï¼Œä½†æ˜¯å®ƒä½¿ç”¨çš„ ticker æ¥æºäºå®ƒå†…éƒ¨è‡ªå·±ç®¡ç†çš„ PIXI.Application å®ä¾‹ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰é‡‡ç”¨ React Pixi çš„å…¨å¥—ä½“ç³»ï¼Œä¹Ÿå°±æ²¡æœ‰è¿™ä¸ª Application å®ä¾‹ï¼Œä¹Ÿå°±ä¸èƒ½æ‹¿å®ƒçš„ Hook ç›´æ¥ç”¨ã€‚</p>\n<p>ä½†ä¸ç”¨æ‹…å¿ƒï¼Œè¿™ä¸ªæ‰€è°“çš„ Application å¹¶æ²¡æœ‰ä»€ä¹ˆé­”æ³•ï¼Œ<a href=\"https://pixijs.io/guides/basics/architecture-overview.html\">åªæ˜¯å¯¹ PixiJS çš„ Loaderã€Ticker å’Œ Render æ¨¡å—çš„ç®€æ˜“å°è£…</a>ã€‚æˆ‘ä»¬ä¾æ—§å¯ä»¥å•ç‹¬ä½¿ç”¨å®ƒçš„ Ticker æ¨¡å—ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useTick</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ticker <span class=\"token operator\">=</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Ticker<span class=\"token punctuation\">.</span>shared\n    ticker<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      ticker<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>callback<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ä¸è¿‡ï¼Œåœ¨å®é™…ä½¿ç”¨ <code class=\"language-text\">useTick</code> æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šä¼ å…¥å†…è”å‡½æ•°ï¼Œå³ <code class=\"language-text\">useTick(() =&gt; {...})</code>ï¼Œè¿›è€Œå¯¼è‡´ <code class=\"language-text\">useEffect</code> è¢«é¢‘ç¹è§¦å‘ã€‚ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ <code class=\"language-text\">useRef</code> ç»´æŠ¤å¯¹æœ€æ–° callback çš„å¼•ç”¨ã€‚è¿™æ˜¯ä¸€ç§<a href=\"https://zh-hans.reactjs.org/docs/hooks-faq.html#how-to-read-an-often-changing-value-from-usecallback\">å†™åœ¨ React å®˜æ–¹æ–‡æ¡£ä¸Šï¼Œä½†å¹¶ä¸è¢«æ¨è</a>çš„åšæ³•ï¼Œä¸è¿‡å¯ä»¥å‡è½»è°ƒç”¨è€…çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚React Pixi æºç ä¸­é‡‡ç”¨çš„å°±æ˜¯è¿™ç§åšæ³•ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useTick</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> savedRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    savedRef<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> callback\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>callback<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  \n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ticker <span class=\"token operator\">=</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Ticker<span class=\"token punctuation\">.</span>shared\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">tick</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">delta</span> <span class=\"token operator\">=></span> savedRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">?.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>ticker<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>delta<span class=\"token punctuation\">,</span> ticker<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    ticker<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>tick<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      ticker<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>tick<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ç¬¬äºŒç§æ–¹æ¡ˆåˆ™æ˜¯ä¿æŒæˆ‘ä»¬å…ˆå‰çš„å®ç°ä¸å˜ï¼Œä½†è°ƒç”¨è€…å¿…é¡»å°å¿ƒåœ°é‡‡ç”¨ <code class=\"language-text\">useCallback</code> æˆ– <code class=\"language-text\">useReducer</code>ï¼ˆå½“ <code class=\"language-text\">useCallback</code> çš„ä¾èµ–ç»å¸¸å‘ç”Ÿå˜åŒ–æ—¶ï¼‰ä¿æŒä¼ å…¥ <code class=\"language-text\">useTick</code> çš„ callback ä¸é¢‘ç¹æ”¹å˜ã€‚</p>\n<p>è¿™æ˜¯ä¸€ä¸ª Hooks ä½¿ç”¨ä¸­çš„ç»å…¸é—®é¢˜äº†ã€‚ç¤¾åŒºä¸­å·²ç»æœ‰ä¸å°‘æ–‡ç« ï¼ˆå¦‚<a href=\"https://zhuanlan.zhihu.com/p/98554943\">è¿™ç¯‡</a>æˆ–<a href=\"https://zhuanlan.zhihu.com/p/56975681\">è¿™ç¯‡</a>ï¼‰æ¢è®¨è¿™ä¸€è¯é¢˜ï¼Œæœ¬æ–‡ä¸ä½œå±•å¼€ã€‚ä¸ºäº†ä¿æŒä¸ React Pixi è¡Œä¸ºçš„ä¸€è‡´æ€§ï¼Œç›®å‰é‡‡å–äº†ç¬¬ä¸€ç§æ–¹æ¡ˆã€‚</p>\n<h3>æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·</h3>\n<p>ç”±äºåæ ‡è½¬æ¢å’Œç¼©æ”¾çš„ Hook éƒ½ç”¨åˆ°äº† Contextï¼Œæˆ‘ä»¬éœ€è¦åœ¨è°ƒç”¨ React Pixi çš„ <code class=\"language-text\">render</code> æ–¹æ³•æ—¶ä¸º children å¥—ä¸Šä¸€å±‚ Providerï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> project <span class=\"token operator\">=</span> pixiOverlay<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>latLngToLayerPoint\n  <span class=\"token keyword\">const</span> provider <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>PixiOverlayProvider value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>project<span class=\"token punctuation\">,</span> scale<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PixiOverlayProvider<span class=\"token operator\">></span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>provider<span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>children<span class=\"token punctuation\">,</span> pixiOverlay<span class=\"token punctuation\">,</span> scale<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>æœ€åç”¨ä¸€ä¸ªç»¼åˆæ€§çš„ä¾‹å­æ”¶å°¾ï¼Œåˆ©ç”¨å„ä¸ª Hook åˆ›å»ºä¸€ä¸ªä¸æ–­å¹³ç§»çš„å°å›¾æ ‡ï¼Œå¹¶åœ¨ç¼©æ”¾ä¸­ä¿æŒå›¾æ ‡å¤§å°ä¸å˜ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">MyContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>containerX<span class=\"token punctuation\">,</span> containerY<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useProject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">51.5</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.09</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>markerOffset<span class=\"token punctuation\">,</span> setMarkerOffset<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>markerX<span class=\"token punctuation\">,</span> markerY<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useProject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">51.5</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.09</span> <span class=\"token operator\">+</span> markerOffset<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>containerX<span class=\"token punctuation\">,</span> containerY<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> scale <span class=\"token operator\">=</span> <span class=\"token function\">useScale</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>direction<span class=\"token punctuation\">,</span> setDirection<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">useTick</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">delta</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setMarkerOffset</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> val <span class=\"token operator\">+</span> delta <span class=\"token operator\">*</span> direction <span class=\"token operator\">/</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>markerOffset <span class=\"token operator\">></span> <span class=\"token number\">0.05</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setDirection</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>markerOffset <span class=\"token operator\">&lt;</span> <span class=\"token operator\">-</span><span class=\"token number\">0.05</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setDirection</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Container x<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>containerX<span class=\"token punctuation\">}</span> y<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>containerY<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Sprite x<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>markerX<span class=\"token punctuation\">}</span> y<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>markerY<span class=\"token punctuation\">}</span> anchor<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">}</span> scale<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token operator\">/</span>scale<span class=\"token punctuation\">}</span> image<span class=\"token operator\">=</span><span class=\"token string\">\"https://s3-us-west-2.amazonaws.com/s.cdpn.io/693612/IaUrttj.png\"</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Container<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><img src=\"/97eca8cc96ea84417b629d88fb7c2387/demo.gif\" alt=\"Demo\"></p>\n<h2>ç»“è¯­</h2>\n<p>è™½ç„¶çœ‹ä¸Šå»æˆ‘ä»¬æ²¿ç€å¾ˆé¡ºç•…çš„æ€è·¯å®Œæˆäº†è¿™ä¸€åˆ‡ï¼Œæœ€åçš„ä»£ç é‡ä¹Ÿä¸å¤šï¼Œå›å¤´çœ‹å»ä¹Ÿä¸éš¾ï¼Œä½†å½“ä¸­ç»å†çš„æ–¹å‘ä¸æ˜æ—¶çš„æ¢ç´¢å’Œçº ç»“ï¼Œä¹Ÿåªæœ‰è‡ªå·±æ‰çŸ¥é“ã€‚åœ¨è¿™è¿‡ç¨‹ä¸­ä¹Ÿå¯¹ä¸€äº› React çš„æœºåˆ¶æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚æ­£æ‰€è°“çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚</p>\n<p>Leaflet è¿™å—åœ¨æ•´ä¸ªå¤§å‰ç«¯ä¸­åº”è¯¥ç®—æ˜¯æ¯”è¾ƒå°ä¼—çš„é¢†åŸŸï¼Œå¦‚æœæ­£å¥½æœ‰åšè¿™æ–¹é¢å¼€å‘çš„æœ‹å‹ä»¬ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½ä¸ºä½ ä»¬èµ·åˆ°å¸®åŠ©ã€‚</p>","frontmatter":{"title":"React Leaflet + React Pixiï¼šåŒå€çš„å¿«ä¹ï¼Œæˆ‘å…¨éƒ½è¦","date":"2021/11/22","tags":["React","Leaflet","PixiJS"],"prompt":null},"fields":{"slug":"/react-leaflet-react-pixi/","encrypted":null}}},"pageContext":{"id":"1bcd971c-b897-534a-83f2-934b959feb31"}},"staticQueryHashes":["1633816651","3000541721","3000541721"]}