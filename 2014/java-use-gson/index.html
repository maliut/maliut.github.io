<!DOCTYPE html>
<html lang="zh">
    <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <!--<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">-->
    
    <title>Java 使用 Gson 操作 JSON 数据 | Mの综合研究</title>
    <link href="https://cdn.bootcss.com/normalize/8.0.0/normalize.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
    <body>
      
<header role="banner" id="site-banner" class="unselectable center ">
    
        <a id="site-logo" href="/"><span class="site-logo-large">Mの</span><br /><span>综合研究</span></a>
    
    <nav role="navigation" id="site-nav">
        <ul>
        
            <li><a href="/categories/proj" class="intent3"><i class="icon-folder"></i>&nbsp;项目</a></li>
        
            <li><a href="/categories/tech" class=""><i class="icon-cog"></i>&nbsp;技术</a></li>
        
            <li><a href="/categories/life" class=""><i class="icon-heart"></i>&nbsp;生活</a></li>
        
            <li><a href="/idea" class=""><i class="icon-hangouts"></i>&nbsp;想法</a></li>
        
            <li><a href="/about" class=""><i class="icon-user"></i>&nbsp;关于</a></li>
              
        </ul>
    </nav>
</header>
      <main role="main" class="center">
        
<article class="post">
    <h1 class="">Java 使用 Gson 操作 JSON 数据</h1>
    <time class="">2014/12/12</time>
    <section><p>Lab8 需要操作 JSON 格式。毕竟用处广泛，而 Java 中有许多包可以用于操作 JSON （参见：<a href="http://www.json.org/" target="_blank" rel="noopener">http://www.json.org/</a>）</p>
<p>起初使用 org.json ，但是将对象保存为 JSON 时似乎需要将对象的每个属性都手工写入，而我的设想是自动探测对象的所有属性并写为 JSON （毕竟重复劳动）。遍寻网络无果，后来在某个角落发现 Gson 似乎可以实现。遂用之，发现功能强大。</p>
<a id="more"></a>
<h1 id="生成-JSON"><a href="#生成-JSON" class="headerlink" title="生成 JSON"></a>生成 JSON</h1><p>需要生成 JSON 的数据类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> deposit;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Player</span><span class="params">(String name, <span class="keyword">int</span> deposit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.deposit = deposit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用于生成的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"></span><br><span class="line">Player players = <span class="keyword">new</span> Player[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">    players[i] = <span class="keyword">new</span> Player(<span class="string">"name"</span>, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Gson gson = <span class="keyword">new</span> Gson();  <span class="comment">// create Gson object</span></span><br><span class="line">String str = gson.toJson(players);</span><br></pre></td></tr></table></figure>
<p>注：生成 Gson 对象除了用 <code>new Gson()</code> 外还有一种据说更高端的方法，反正我也不知道用处和区别就不写了</p>
<p><code>toJson</code> 方法后的参数可以为对象，也可以为对象数组。都可以生成符合规范的 JSON 格式</p>
<h1 id="读取-JSON"><a href="#读取-JSON" class="headerlink" title="读取 JSON"></a>读取 JSON</h1><p>以从 OpenWeatherMap 的 API 返回的 JSON 为例（查询天气：<a href="http://api.openweathermap.org/data/2.5/weather?q=London" target="_blank" rel="noopener">http://api.openweathermap.org/data/2.5/weather?q=London</a>，各参数可参考 <a href="http://openweathermap.org/weather-data#current" target="_blank" rel="noopener">http://openweathermap.org/weather-data#current</a>）</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">88319</span>,<span class="attr">"dt"</span>:<span class="number">1345284000</span>,<span class="attr">"name"</span>:<span class="string">"Benghazi"</span>,</span><br><span class="line">    <span class="attr">"coord"</span>:&#123;<span class="attr">"lat"</span>:<span class="number">32.12</span>,<span class="attr">"lon"</span>:<span class="number">20.07</span>&#125;,</span><br><span class="line">    <span class="attr">"main"</span>:&#123;<span class="attr">"temp"</span>:<span class="number">306.15</span>,<span class="attr">"pressure"</span>:<span class="number">1013</span>,<span class="attr">"humidity"</span>:<span class="number">44</span>,<span class="attr">"temp_min"</span>:<span class="number">306</span>,<span class="attr">"temp_max"</span>:<span class="number">306</span>&#125;,</span><br><span class="line">    <span class="attr">"wind"</span>:&#123;<span class="attr">"speed"</span>:<span class="number">1</span>,<span class="attr">"deg"</span>:<span class="number">-7</span>&#125;,</span><br><span class="line">    <span class="attr">"weather"</span>:[</span><br><span class="line">                 &#123;<span class="attr">"id"</span>:<span class="number">520</span>,<span class="attr">"main"</span>:<span class="string">"rain"</span>,<span class="attr">"description"</span>:<span class="string">"light intensity shower rain"</span>,<span class="attr">"icon"</span>:<span class="string">"09d"</span>&#125;,</span><br><span class="line">                 &#123;<span class="attr">"id"</span>:<span class="number">500</span>,<span class="attr">"main"</span>:<span class="string">"rain"</span>,<span class="attr">"description"</span>:<span class="string">"light rain"</span>,<span class="attr">"icon"</span>:<span class="string">"10d"</span>&#125;,</span><br><span class="line">                 &#123;<span class="attr">"id"</span>:<span class="number">701</span>,<span class="attr">"main"</span>:<span class="string">"mist"</span>,<span class="attr">"description"</span>:<span class="string">"mist"</span>,<span class="attr">"icon"</span>:<span class="string">"50d"</span>&#125;</span><br><span class="line">              ],</span><br><span class="line">    <span class="attr">"clouds"</span>:&#123;<span class="attr">"all"</span>:<span class="number">90</span>&#125;,</span><br><span class="line">    <span class="attr">"rain"</span>:&#123;<span class="attr">"3h"</span>:<span class="number">3</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>这是一个复杂的 JSON 数据，为了读取需要先根据数据生成特定的类结构。结构如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherState</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Main main;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Weather&gt; weather;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">double</span> temp, temp_min, temp_max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Weather</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：</p>
<ol>
<li>类名随意</li>
<li>变量名需要严格符合 JSON 中的内容</li>
<li>内部类需要 static ，这里使用内部类看起来更加清晰，用继承也可以</li>
<li>变量 private + get/set 方法应该也可以，图方便用 public</li>
<li>不需要把 JSON 中所有的数据都建构出来，你建了多少就会读出来多少（这一点非常好啊）</li>
</ol>
<p>用于读取的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String jsonWeather = <span class="comment">/* 前面的 Json 数据 */</span>;</span><br><span class="line">Gson gson = <span class="keyword">new</span> Gson();  <span class="comment">// create gson object</span></span><br><span class="line">WeatherState w = gson.fromJson(jsonWeather, WeatherState.class);</span><br><span class="line"></span><br><span class="line">System.out.println(w.id);</span><br><span class="line">System.out.println(w.main.temp);</span><br><span class="line">System.out.println(w.weather.get(<span class="number">0</span>).id);</span><br></pre></td></tr></table></figure>
<p>以上即为 Gson 的基本用法</p>
</section>
    <section class="">
        <small>
        TAGS:&nbsp;
            <a class="tag-link" href="/tags/Gson/">Gson</a>&nbsp;|&nbsp;<a class="tag-link" href="/tags/JSON/">JSON</a>&nbsp;|&nbsp;<a class="tag-link" href="/tags/Java/">Java</a>
        
        </small>
    </section>
</article>

    <div id="vcomments"></div>
    <script src="//cdn1.lncld.net/static/js/3.7.3/av-min.js"></script>
    <script src="/Valine.min.js"></script>
    <script type="text/javascript">
        new Valine({
            el: '#vcomments',
            notify: true,
            verify: false,
            app_id: "KNr19IGaxOxhyEPC2OXwmlbK-gzGzoHsz",
            app_key: "6FKxDyP2jMSYNYCKbk71eevC",
            placeholder: "Say something...",
            avatar: 'retro',
            submail_appid: "13112",
            submail_appkey: "e66bb0bad3a54056d660664b3f044ff5",
            submail_template: "e1BUq2",
            post_title: "Java 使用 Gson 操作 JSON 数据"
        });
    </script>

      </main>
    </body>
    <footer role="contentinfo" class="center">
    <div id="site-links">
        <a href="/archives"><i class="icon-database" style="font-size: 15px"></i></a>
        <a href="mailto:lqn619@163.com" target="_blank" rel="external"><i class="icon-at"></i></a>
        <a href="https://github.com/maliut" target="_blank" rel="external"><i class="icon-github"></i></a>
        <a href="https://weibo.com/maliut" target="_blank" rel="external"><i class="icon-sina-weibo"></i></a>
        <a href="https://steamcommunity.com/id/maliut" target="_blank" rel="external"><i class="icon-steam"></i></a>
    </div>
    <p id="copyright">2020&nbsp;&copy;&nbsp;<a href="/">Mの综合研究</a>&nbsp;|&nbsp;Theme <a href="https://github.com/maliut/hexo-theme-simpow" title="SimPow" target="_blank" rel="noopener">SimPow</a></p>
</footer>
<script>
    console.log('Welcome!\nTheme SimPow inspired by Typescript & orzfly.com');
</script>
</html>